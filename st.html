<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>柒蓝 - Picture display</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.1/viewer.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.1/viewer.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h1, h4 {
            text-align: center;
            color: #7EA1C4;
        }

        body {
            text-align: center;
        }

        .img-container {
            width: 300px;
            margin-top: 15px;
            border-radius: 8px;
            text-align: center;
            box-sizing: border-box;
            border: 2px solid #dc61cb;
            padding: 0px;
            position: relative;
        }

        #imagesContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .loading-image {
            width: 100%;
            height: 100%;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loaded-image {
            display: none;
        }

        .pic {
            width: 100%;
            height: 370px;
            cursor: pointer;
            max-width: 100%;
            border: 1px solid #dee2e6;
            margin-right: 0.5em;
            border-radius: 6px;
            box-shadow: 6px 6px 12px 0px rgba(0, 0, 0, 0.2), 0px 0px 8px 0px rgba(0, 0, 0, 0.19);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            max-width: 100%;
            max-height: 100%;
            padding: 50px 0;
        }

        .modal-content {
            margin: auto;
            display: block;
            max-width: 855px;
            max-height: 60%;
            margin-bottom: 1%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .close {
            position: absolute;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            color: red;
            font-size: 155px;
            cursor: pointer;
        }
    </style>
    
</head>

<body>
    <div style="text-align: center;">
        <img style="font-weight: 200; font-size: 200%;" src="https://moe-counter.glitch.me/get/@qlst" alt=":name" />
    </div>

    <h1>点击图片查看或长摁保存，不显示就是资源已被删除</h1>
    <div id="imagesContainer"></div>

    <script>
        function getParameterByName(name, url) {
            if (!url) {
                url = window.location.href;
            }
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) {
                return null;
            }
            if (!results[2]) {
                return '';
            }
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
    
        var id = getParameterByName('id');
        var items = id.split('QL');
        var container = document.getElementById('imagesContainer');
        var itemsCount = items.length;
        var batchSize = 1;
    
        function addBatchImages(startIndex) {
            var endIndex = Math.min(startIndex + batchSize, itemsCount);
            var row = document.createElement("div");
            row.className = "image-row";
    
            for (var i = startIndex; i < endIndex; i++) {
                var imgContainer = document.createElement("div");
                imgContainer.className = "img-container";
    
                var loadingImg = document.createElement("div");
                loadingImg.className = "loading-image";
    
                var loadedImg = document.createElement("img");
                loadedImg.className = "pic";
                loadedImg.src = "https://qlpixiv.qilan.workers.dev/" + items[i];
                loadedImg.onerror = function () {
                    this.style.display = 'none';
                    var defaultSrc = "https://img.qlvv.cn/file/ad3880f3b47a0c6d4d862.png";
                    this.src = defaultSrc;
                };
    
                imgContainer.appendChild(loadingImg);
                imgContainer.appendChild(loadedImg);
    
                row.appendChild(imgContainer);
            }
    
            container.appendChild(row);
    
            if (endIndex < itemsCount) {
                setTimeout(function () {
                    addBatchImages(endIndex);
                }, 400);
            } else {
                // 初始化 Viewer.js
                var imgs = document.querySelectorAll('.pic');
                var viewer = new Viewer(imgs, {
                    inline: false,
                    viewed: function () {
                        viewer.zoomTo(1);
                    },
                    url: function (image) {
                        return image.src;
                    },
                });
            }
        }
    
        addBatchImages(0);
    </script>
    
</body>

</html>
